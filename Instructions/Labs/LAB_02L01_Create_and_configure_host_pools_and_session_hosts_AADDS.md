---
lab:
    title: 'ラボ: ホスト プールとセッション ホストを作成および構成する (Azure AD DS)'
    module: 'モジュール 2: AVD インフラストラクチャを実装する'
---

# ラボ - ホスト プールとセッション ホストを作成および構成する (Azure AD DS)
# 受講生用ラボ マニュアル

## ラボの依存関係

- Azure サブスクリプション
- Azure サブスクリプションに関連付けられた Azure AD テナント内で グローバル管理者ロールを持つMicrosoft アカウントまたは Azure AD、あるいは Azure サブスクリプション内 で所有者または共同作成はのロールを持つ Microsoft アカウントまたは Azure AD
- 実施するラボ - **Azure Virtual Desktop (Azure AD DS) のデプロイを準備する**

## 推定所要時間

60 分

## ラボ シナリオ

Azure Active Directory ドメインサービス (Azure AD DS) 環境でホスト プールとセッション ホストを作成して構成する必要があります。

## 目標
  
このラボを完了すると、次のことができるようになります。

- Azure AD DS ドメインで Azure Virtual Desktop 環境を構成する。 
- Azure AD DS ドメインで Azure Virtual Desktop 環境を検証する。 

## ラボ ファイル

- なし 

## 説明

### 演習 1: Azure Virtual Desktop 環境を構成する
  
この演習の主なタスクは次のとおりです。

1. Azure Virtual Desktop ホスト プールのデプロイ用の AD DS ドメインと Azure サブスクリプションを準備する
1. Azure Virtual Desktop ホスト プールをデプロイする
1. Azure Virtual Desktop アプリケーション グループを構成する
1. Azure Virtual Desktop ワークスペースを構成する

#### タスク 1: Azure Virtual Desktop ホスト プールのデプロイ用の AD DS ドメインと Azure サブスクリプションを準備する

1. ラボ コンピューターから、Web ブラウザーを起動し、[Azure portal](https://portal.azure.com) に移動し、このラボで使用するサブスクリプションの所有者ロールを持つユーザー アカウントの資格情報を指定してサインインします。
1. ラボ コンピューターの Azure portal で、**仮想マシン**を検索して選択し、**「仮想マシン」** ブレードから **az140-cl-vm11a** エントリを選択します。これにより、**az140-cl-vm11a** ブレードが開きます。
1. **az140-cl-vm11a** ブレードで、**「接続」** を選択し、ドロップダウン メニューで、**「Bastion」** を選択し、**「az140-cl-vm11a \| 接続」** ブレードの Bastion タブで、**「Bastion の使用」** を選択します。
1. プロンプトが表示されたら、次の資格情報を入力して、**「接続」** を選択します。

   |設定|値|
   |---|---|
   |ユーザー名|**Student@adatum.com**|
   |パスワード|**Pa55w.rd1234**|

1. リモート デスクトップ内で **az140-cl-vm11a** Azure VM に移動し、Microsoft Edge を起動し、[Azure portal](https://portal.azure.com) に移動します。このアカウントの作成時に設定したパスワードを使用して **aadadmin1** ユーザー アカウントのユーザー プリンシパル名を指定してサインインします。

   >**注**: aadadmin1 アカウントのユーザープリンシパル名 (UPN) 属性を特定するには、Active Directory ユーザーとコンピューター コンソールからプロパティ ダイアログ ボックスを確認するか、ラボ コンピューターに戻って、Azure portal の Azure AD テナント ブレードからプロパティを確認します。

1. **az140-cl-vm11a** へのリモート デスクトップ セッション内で、Azure portal を表示している Microsoft Edge で、**Cloud Shell** で PowerShell セッションを開き、**Microsoft.Desktop Virtualization** リソース プロバイダーを次のように登録します。

   ```powershell
   Register-AzResourceProvider -ProviderNamespace Microsoft.DesktopVirtualization
   ```

1. **az140-cl-vm11a** へのリモート デスクトップ セッション内で、Azure portal を表示している Microsoft Edge で、**仮想ネットワーク**を検索して選択し、**「仮想ネットワーク」** ブレードから **az140-aadds-vnet11a** エントリを選択します。 
1. **az140-aadds-vnet11a** ブレードで、**「サブネット」** を選択し、**「サブネット」** ブレードで、**「+ サブネット」** を選択し、**「サブネットの追加」** ブレードで、**「名前」** テキストボックスに「**hp1-Subnet**」と入力し、他のすべての設定をデフォルト値のままにして、**「保存」** を選択します。 

#### タスク 2: Azure Virtual Desktop ホスト プールをデプロイする

1. **az140-cl-vm11a** へのリモート デスクトップセッション内で、Azure portal を表示している Microsoft Edge ウィンドウで、**Azure Virtual Desktop** ブレードの左側の垂直メニューの **「管理」** セクションで、**Azure Virtual Desktop** を検索して選択します。**「ホストプール」** を選択し、**「Windows 仮想デスクトップ \| ホスト プール」** ブレードで、**「+ 作成」** を選択します。 
1. **「ホスト プールの作成」** ブレードの **「基本」** タブで、次の設定を指定し、**「次へ: 仮想マシン >」** を選択します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使用する Azure サブスクリプションの名前|
   |リソース グループ|新しいリソース グループの名前 **az140-21a-RG**|
   |ホストプール名|**az140-21a-hp1**|
   |場所|このラボの前半で Azure AD DS インスタンスをデプロイした Azure リージョンの名前|
   |検証環境|**いいえ**|
   |ホスト プールの種類|**プールされた**|
   |最大セッション数|**10**|
   |負荷分散アルゴリズム|**幅優先**|

1. **「ホスト プールの作成」** ブレードの **「仮想マシン」** タブで、次の設定を指定し (他は既定値のままにします)、**「次へ: ワークスペース >**」 を選択します (*<Azure_AD_domain_name>* プレースホルダーは Azure AD DS インスタンスをデプロイしたサブスクリプションに関連のある Azure AD テナントの名前に置き換え、`<password>` プレースホルダーは aadadmin1 アカウントの作成時に設定したパスワードに置き換えます)。

   > **注**: 必ず使用したパスワードは覚えておいてください。このラボとその後のラボで必要になります。:

   |設定|値|
   |---|---|
   |仮想マシンの追加|**はい**|
   |リソース グループ|**既定はホストプールと同じ**|
   |仮想マシンの場所|このラボの最初の演習でリソースをデプロイした Azure リージョンの名前|
   |可用性オプション|**インフラストラクチャの冗長性は必要ありません**|
   |イメージの種類|**ギャラリー**|
   |イメージ|**Windows 10 Enterprise マルチセッション、バージョン 2004 + Microsoft 365 Apps**|
   |仮想マシンのサイズ|**Standard D2s v3**|
   |VM の数|**2**|
   |名前のプレフィックス|**az140-21-p1**|
   |OS ディスクの種類|**Standard SSD**|
   |仮想ネットワーク|**az140-aadds-vnet11a**|
   |サブネット|**hp1-Subnet (10.10.1.0/24)**|
   |ネットワーク セキュリティ グループ|**Basic**|
   |パブリック受信ポート|**いいえ**|
   |特定のドメインまたはユニット|**はい**|
   |参加するドメイン|**adatum.com**|
   |組織単位パス|**OU=AADDC Computers,DC=adatum,DC=com**|
   |AD ドメインの UPN への参加|**aadadmin1@***<Azure_AD_domain_name>*|
   |パスワード|`<password>`|
   |仮想マシン管理者アカウントのユーザー名|**student**|
   |仮想マシン管理者アカウントのパスワード|**Pa55w.rd1234**|

1. **「ホスト プールの作成」** ブレードの **「ワークスペース」** タブで、次の設定を指定し、**「確認および作成」** を選択します。

   |設定|値|
   |---|---|
   |デスクトップ アプリ グループを登録する|**いいえ**|

1. **「ホストプールの作成」** ブレードの **「確認および作成」** タブで、**「作成」** を選択します。

   > **注**: デプロイが完了するのを待ちます。通常は 15 分ほどかかります。

#### タスク 3: Azure Virtual Desktop アプリケーション グループを構成する

1. **az140-cl-vm11a** へのリモート デスクトップ セッション内で、Azure portal で **Azure Virtual Desktop** を検索して選択し、**「Azure Virtual Desktop」** ブレードで **「アプリケーション グループ」** を選択します。
1. 「**Azure Virtual Desktop \| アプリケーション グループ」** ブレードで、自動生成された **az140-21a-hp1-DAG** デスクトップ アプリケーション グループを選択します。
1. 「**az140-21a-hp1-DAG**」 ブレードの左側にある垂直メニューの 「**管理**」 セクションで、「**割り当て**」 を選択します。
1. 「**az140-21a-hp1-DAG \| 割り当て**」 ブレードで、**「+ 追加」** を選択します。
1. **「Azure AD ユーザーまたはユーザー グループの選択」** ブレードで、**「az140-wvd-apooled」** を選択し、**「選択」** をクリックします。
1. 「**Azure Virtual Desktop \| アプリケーション グループ**」 ブレードに戻り、もう一度 **「+ 作成」** を選択します。
1. **「アプリケーション グループの作成」** ブレードの **「基本」** タブで、次の設定を指定し、**「次へ: アプリケーション >」** を選択します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使用する Azure サブスクリプションの名前|
   |リソース グループ|**az140-21a-RG**|
   |ホスト プール|**az140-21a-hp1**|
   |アプリケーション グループの種類|**RemoteApp**|
   |アプリケーション グループ名|**az140-21a-hp1-Office365-RAG**|

1. 「**アプリケーション グループの作成**」 ブレードの 「**アプリケーション**」 タブで、**「+ アプリケーションの追加」** を選択します。
1. 「**アプリケーションの追加**」 ブレードで、次のように設定してから 「**保存**」 を選択します。

   |設定|値|
   |---|---|
   |アプリケーション ソース|**「スタート」 メニュー**|
   |アプリケーション|**Word**|
   |説明|**Microsoft Word**|
   |必須のコマンド ライン|**いいえ**|

1. 「**アプリケーション グループの作成**」 ブレードの 「**アプリケーション**」 タブに戻り、**「+ アプリケーションの追加」** を選択します。
1. 「**アプリケーションの追加**」 ブレードで、次のように設定してから 「**保存**」 を選択します。

   |設定|値|
   |---|---|
   |アプリケーション ソース|**「スタート」 メニュー**|
   |アプリケーション|**Excel**|
   |説明|**Microsoft Excel**|
   |必須のコマンド ライン|**いいえ**|

1. 「**アプリケーション グループの作成**」 ブレードの 「**アプリケーション**」 タブに戻り、**「+ アプリケーションの追加」** を選択します。
1. 「**アプリケーションの追加**」 ブレードで、次のように設定してから 「**保存**」 を選択します。

   |設定|値|
   |---|---|
   |アプリケーション ソース|**「スタート」 メニュー**|
   |アプリケーション|**PowerPoint**|
   |説明|**Microsoft PowerPoint**|
   |必須のコマンド ライン|**いいえ**|

1. 「**アプリケーション グループの作成**」 ブレードの 「**アプリケーション**」 タブに戻り、**「次へ: 割り当て >**」 を選択します。
1. 「**アプリケーション グループの作成**」 ブレードの 「**割り当て**」 タブで、**「+ Azure AD ユーザーまたはユーザー グループの追加」** を選択します。
1. **「Azure AD ユーザーまたはユーザー グループの選択」** ブレードで、**「az140-wvd-aremote-appd」** を選択し、**「選択」** をクリックします。
1. 「**アプリケーション グループの作成**」 ブレードの 「**割り当て**」 タブに戻り、**「次へ: ワークスペース >**」 を選択します。
1. **「ワークスペースの作成」** ブレードの **「ワークスペース」** タブで、次の設定を指定し、**「確認および作成」** を選択します。

   |設定|値|
   |---|---|
   |アプリケーション グループを登録する|**いいえ**|

1. **「アプリケーション グループの作成」** ブレードの **「確認および作成」** タブで、**「作成」** を選択します。

   > **注**: 次に、アプリケーション ソースとしてファイル パスに基づいてアプリケーション グループを作成します

1. **az140-cl-vm11a** へのリモート デスクトップ セッション内で、Azure portal を表示する Web ブラウザーの画面で **Azure Virtual Desktop** を検索して選択し、**「Azure Virtual Desktop」** ブレードで **「アプリケーション グループ」** を選択します。
1. 「**Azure Virtual Desktop \| アプリケーション グループ**」 ブレードで、**「+ 作成」** を選択します。 
1. **「アプリケーション グループの作成」** ブレードの **「基本」** タブで、次の設定を指定し、**「次へ: アプリケーション >」** を選択します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使用する Azure サブスクリプションの名前|
   |リソース グループ|**az140-21a-RG**|
   |ホスト プール|**az140-21a-hp1**|
   |アプリケーション グループの種類|**RemoteApp**|
   |アプリケーション グループ名|**az140-21a-hp1-Utilities-RAG**|

1. 「**アプリケーション グループの作成**」 ブレードの 「**アプリケーション**」 タブで、**「+ アプリケーションの追加」** を選択します。
1. 「**アプリケーションの追加**」 ブレードで、次のように設定してから 「**保存**」 を選択します。

   |設定|値|
   |---|---|
   |アプリケーション ソース|**ファイル パス**|
   |アプリケーション パス|**C:\Windows\system32\cmd.exe**|
   |アプリケーション名|**コマンド プロンプト**|
   |表示名|**コマンド プロンプト**|
   |アイコン パス|**C:\Windows\system32\cmd.exe**|
   |アイコン インデックス|**0**|
   |説明|**Windows コマンド プロンプト**|
   |必須のコマンド ライン|**いいえ**|

1. 「**アプリケーション グループの作成**」 ブレードの 「**アプリケーション**」 タブに戻り、**「次へ: 割り当て >**」 を選択します。
1. 「**アプリケーション グループの作成**」 ブレードの 「**割り当て**」 タブで、**「+ Azure AD ユーザーまたはユーザー グループの追加」** を選択します。
1. **「Azure AD ユーザーまたはユーザー グループの選択」** ブレードで、**「az140-wvd-aremote-appd」** と **「「az140-wvd-aadmins」」** を選択し、**「選択」** をクリックします。
1. 「**アプリケーション グループの作成**」 ブレードの 「**割り当て**」 タブに戻り、**「次へ: ワークスペース >**」 を選択します。
1. **「ワークスペースの作成」** ブレードの **「ワークスペース」** タブで、次の設定を指定し、**「確認および作成」** を選択します。

   |設定|値|
   |---|---|
   |アプリケーション グループを登録する|**いいえ**|

1. **「アプリケーション グループの作成」** ブレードの **「確認および作成」** タブで、**「作成」** を選択します。

#### タスク 4: Azure Virtual Desktop ワークスペースを構成する

1. **az140-cl-vm11a** へのリモート デスクトップ セッション内で、Azure portal を表示する Microsoft Edge で **Azure Virtual Desktop** を検索して選択し、**「Azure Virtual Desktop」** ブレードで **「ワークスペース」** を選択します。
1. 「**Azure Virtual Desktop \| ワークスペース**」 ブレードで、**「+ 作成」** を選択します。 
1. **「ワークスペースの作成」** ブレードの **「基本」** タブで、次の設定を指定し、**「次へ: アプリケーション グループ >」** を選択します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使用する Azure サブスクリプションの名前|
   |リソース グループ|**az140-21a-RG**|
   |ワークスペース名|**az140-21a-ws1**|
   |フレンドリ名|**az140-21a-ws1**|
   |場所|このラボでリソースをデプロイした Azure リージョンの名前||

1. 「**ワークスペースの作成**」 ブレードの 「**アプリケーション グループ**」 タブで、次の設定を指定します。

   |設定|値|
   |---|---|
   |アプリケーション グループを登録する|**はい**|

1. 「**ワークスペースの作成**」 ブレードの 「**ワークスペース**」 タブで、**「+ アプリケーション グループの登録」** を選択します。
1. **「アプリケーション グループの追加」** ブレードで、**az140-21a-hp1-DAG**、**az140-21a-hp1-Office365-RAG**、および **az140-21a-hp1-Utilities-RAG** エントリの横にあるプラス記号を選択し、**「選択」** をクリックします。 
1. **「ワークスペースの作成」** ブレードの **「アプリケーション グループ」** タブに戻り、**「確認および作成」** を選択します。
1. **「ワークスペースの作成」** ブレードの **「確認および作成」** タブで、**「作成」** を選択します。

### 演習 2: Azure Virtual Desktop 環境を検証する
  
この演習の主なタスクは次のとおりです。

1. Microsoft リモート デスクトップ クライアント (MSRDC) を Windows 10 コンピューターにインストールする
1. Azure Virtual Desktop ワークスペースにサブスクライブする
1. Azure Virtual Desktop アプリをテストする

#### タスク 1: Microsoft リモート デスクトップ クライアント (MSRDC) を Windows 10 コンピューターにインストールする

1. **az140-cl-vm11a** へのリモート デスクトップ セッション内で、Microsoft Edge を起動し、[Windows デスクトップ クライアントのダウンロード ページ](https://go.microsoft.com/fwlink/?linkid=2068602)に移動し、プロンプトが表示されたら、プロンプトに従ってインストールを実行します。**「このマシンのすべてのユーザーにインストール」** オプションを選択します。 
1. インストールが完了したら、リモート デスクトップ クライアントを起動します。

#### タスク 2: Azure Virtual Desktop ワークスペースにサブスクライブする

1. **リモート デスクトップ** クライアント ウィンドウで、**「サブスクライブ」** を選択し、プロンプトが表示されたら、**aaduser1** 資格情報を使用してサインインします (ユーザー名として userPrincipalName 属性を使用し、このアカウントの作成時に設定したパスワードを使います)。 

   > **注**: または、「**リモート デスクトップ** クライアント」 ウィンドウで **「URL でサブスクライブ」** を選択し、**「ワークスペースのサブスクライブ」** ペインで **「電子メール」 または 「ワークスペース URL」** に [**https://rdweb.wvd.microsoft.com/api/arm/feeddiscovery**] と入力して、 **「次へ」** を選択します。プロンプトが表示されたら、**aaduser1** 資格情報を使用してサインインします (userPrincipalName 属性をユーザー名として使用し、**Pa55w.rd1234** をパスワードとして使用します)。 

   > **注**: **aaduser1** のユーザー プリンシパル名は **aaduser1@***<Azure_AD_domain_name>* の形式である必要があります。ここで、*<Azure_AD_domain_name>* プレースホルダーは、Azure ADDS インスタンスをデプロイしたサブスクリプションに関連付けられた Azure AD テナントの名前と一致します。

1. **「すべてのアプリにサインインしたままにする」** ウィンドウで、**「組織にデバイスの管理を許可する」** チェックボックスをオフにし、**「いいえ、このアプリのみにサインインします」** を選択します。 
1. **「リモート デスクトップ」** ページに、グループ メンバーシップを介してユーザー アカウント **aaduser1** に関連付けられているアプリケーション グループに含まれているアプリケーションのリストが表示されていることを確認します。 

#### タスク 3: Azure Virtual Desktop アプリをテストする

1. **az140-cl-vm11a** へのリモート デスクトップ セッション内の **「リモート デスクトップ」** クライアント ウィンドウのアプリケーションのリストで、**「コマンド プロンプト」** をダブルクリックし、**「コマンド プロンプト」** ウィンドウが起動することを確認します。認証を求められたら、**aaduser1** ユーザー アカウント向けに設定したパスワードを入力し、**「このアカウントを記憶する」** チェックボックスを選択して、**「OK」** を選択します。

   > **注**: 最初は、アプリケーションの起動に数分かかる場合がありますが、その後、アプリケーションの起動ははるかに高速になります。

1. コマンドプロンプトで、**hostname** と入力し、**Enter** キーを押して、コマンド プロンプトが実行されているコンピューターの名前を表示します。

   > **注**: 表示される名前が **az140-cl-vm11a** ではなく、**az140-21-p1-0** または **az140-21-p1-1** のいずれかであることを確認します。

1. コマンド プロンプトで、**logoff** と入力し、**Enter** キーを押して、現在のリモート アプリセッションからログオフします。
1. **az140-cl-vm11a** へのリモート デスクトップ セッション内の 「**リモート デスクトップ** クライアント」 ウィンドウのアプリケーションのリストで、**「SessionDesktop」** をダブルクリックし、リモート デスクトップ セッションが起動することを確認します。 
1. 「**既定のデスクトップ** セッション」 で、「**スタート**」 を右クリックし、**「ファイル名を指定して実行」** を選択し、**「ファイル名を指定して実行」** ダイアログ ボックスの **「開く**」 テキストボックスに **cmd** と入力して、**「OK」** を選択します。 
1. **既定のデスクトップ** セッション内のコマンドプロンプトで、**hostname** と入力し、**Enter** キーを押して、リモートデスクトップセッションが実行されているコンピューターの名前を表示します
1. 表示される名前が **az140-21-p1-0**、**az140-21-p1-1**、または **az140-21-p1-2** のいずれかであることを確認します。
